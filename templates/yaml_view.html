<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LazyOwn Command and Control Center</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/style.css" rel="stylesheet" />
</head>
<body class="bg-dark text-success">
    <div class="loading-container">
        <div class="loading-spinner"></div>
    </div>
    <div class="container mt-5">
        <div class="text-center mb-4">
            <h1 class="neon-text">LazyOwn Command and Control Center [;,;]</h1>
            <pre class="neon-text chico">
                .-==++++=-:.                                      
            .=*%@@@@@@@@@@@@@@%+-                                  
          =%@@%@@@@@@@@@@@@@@@%#%@#-                               
       .*@@**%@@@@@@@@@@@@@@==#@@@@@@=                             
      +@@*+@@@@@@@@@@@@@@@%:%@@@@@@@@@@-                           
     %@@*+@@@@@@@@@@@@@@@@=%@@@@@@@@@@@@:                          
    +@@@*@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@%*                          
    *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*%                          
    +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=@                          
    :@@@@@@@@@@@@@@@@@@@@@+@@@@@@@@@@@@:@                          
     #@#@@@@@@@@@@@@@@#**+-=@%@@@@@@@#@:@                          
   :%%@@%@@@@@@@@%@@@%@@@@@*:#@@@@@@@+#=#                          
   =:.:#@@%+@@+*%@@@*-.  .=%@=%@@@@@@@=@+                          
    +%  :%@%%**@@%=       *%@-#@@@@@@@@@:                          
    .@:   ::+#**=         %@*%+*#%@@%@@+                           
    %**==+#*:@%#=-:      +@*@@@@@@@#**:                            
   -@@@@@%%=:=@@@@@@@%#%%@#%@@#*=:==                               
     .-:=#+   .=%%@@%%#@@@@@#+=.-*                                 
         =@# -%%@@@@%++#=**==- =@+                                 
          #@@@@@@@@@@@#%:++=*%:%@@                                 
         -*=+#+##**#+==.  ==*@@#@+                                 
           :=#=--::.    *=#@%@%=                                   
            :+#-      :%##@@@#.                                    
             ===     =%+#@@@=                                      
              :--::+#*=%@%@:                                       
               *###*#%%#*%.                                        
                :======-.                                        
</pre>
        </div>
        <div class="card bg-secondary text-light p-4 mb-4">
            <h1>Techniques in {{ directory }}</h1>
            <p>
                Disclaimer: This test is specifically targeted by payload.json within the LazyOwn Framework, not by the LazyOwn Agent. [!] Please do not use this in military or secret service organizations, or for illegal purposes. (This is non-binding, as these entities often disregard laws and ethics anyway.)
            </p>
            <a class="neon-text" href="{{ url_for('index') }}">Back to index.</a>
            <form id="test-form">
                <div class="table-container">
                    {% for test in yaml_data %}
                        <div class="table-row">
                            <div class="terminal-window">
                                <div class="terminal-controls">
                                    <div class="terminal-control-button close-button"></div>
                                    <div class="terminal-control-button minimize-button"></div>
                                    <div class="terminal-control-button maximize-button"></div>
                                </div>                            
                                <div class="table-cell check">
                                    <input type="checkbox" name="selected_tests" value="{{ test.auto_generated_guid }}">
                                </div>
                                <div class="table-cell"><div class="terminal-title">{{ test.name }}</div></div>
                                <div class="table-cell card-body">{{ test.description }}</div>
                                <div class="table-cell">{{ test.supported_platforms }}</div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <button type="button" class="btn-run-test" onclick="runTest()">Run Test</button>
            </form>
            <div class="terminal-window">
                <div class="terminal-controls">
                    <div class="terminal-control-button close-button"></div>
                    <div class="terminal-control-button minimize-button"></div>
                    <div class="terminal-control-button maximize-button"></div>
                </div>                            
                <div class="table-cell"><div class="terminal-title">Results</div></div>
                <div class="table-cell card-body"><div id="output"></div></div>
            </div>            
            <br>
            <a class="neon-text" href="{{ url_for('index') }}">Back to index.</a>
            <h2 class="mt-4">Contact</h2>
            <p>For any questions or feedback, please reach out to <a href="mailto\:grisiscomeback[at]gmail[dot]com" class="text-success">Gris Iscomeback</a>.</p>
        </div>
        <div class="footer text-center mt-4 p-3 bg-secondary text-light">
            <p>&copy; 2024 LazyOwn Web\$hellz. All rights GPLv3.</p>
        </div>
        <div id="toastr" class="toastr alert alert-success" role="alert">
            Command exec successfully.
        </div>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-T4VF6JJ095"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-T4VF6JJ095');
        </script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
        <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                document.querySelector('.loading-container').style.display = 'none';
                kofiWidgetOverlay.draw('grisuno', {
                    'type': 'floating-chat',
                    'floating-chat.donateButton.text': 'Support me',
                    'floating-chat.donateButton.background-color': '#5cb85c',
                    'floating-chat.donateButton.text-color': '#fff'
                });
            });
            async function fetchLog() {
                    try {
                        const response = await fetch('/api/output');

                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }

                        const data = await response.json();
                        const outputDiv = document.getElementById('output');
                        const outputText = data.output.replace(/\n/g, '<br>');
                        const cleanOutputText = stripAnsi(outputText);

                        outputDiv.innerHTML += `<p>${cleanOutputText}</p>`;

                        console.log(data);
                    } catch (error) {
                        console.error('There was a problem with the fetch operation:', error);
                    }
                }            
            function toastr(command){
                var toastr = document.getElementById('toastr');
                toastr.classList.add('show');
                setTimeout(function() {
                    toastr.classList.remove('show');
                }, 22000);
                toastr.innerHTML += "<div class='.neon-text'> " + command + " </div>"
                fetchLog()
            };
            function atomicGen(id, type){
                let command;

                if (type === 'agent') {
                    command = "atomic_agent web";
                } else {
                    command = "atomic_" + type + " " + id;
                }
                console.log(command)
                fetch('/api/run', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ command })
                })
                .then(response => response.json())
                .then(data => {
                    const outputDiv = document.getElementById('output');
                    if (data.error) {
                        outputDiv.innerHTML += `<p style="color: red;">${data.error}</p>`;
                    } else {
                        toastr(command)
                    }
                });                
            }
            function runTest() {

                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                const valoresMarcados = [];
                checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    atomicGen(checkbox.value, 'gen');
                }
                });
                atomicGen('lol', 'agent');
            }
        </script>
    </div>
</body>
</html>
